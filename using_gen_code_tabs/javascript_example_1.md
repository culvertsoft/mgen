---
---
Just as in the c++ example, this examples shows how to serialize objects to JSON and back.

The code generated in previous examples creates what we call a blueprint. The blueprint is used by the javascript library to create a class registry. Both the blueprint and the mgen javascript library can be used in an oldschool manner (that pollutes the window object) or by using the AMD approach (tested with require.js).

This is how the blueprint will look like when generated from the previous project example:

{% highlight javascript %}

/* Autogenerated code by MGen for JavaScript */

(function(){
	"use strict";
	var blueprint = {};
	
	blueprint.classes = {};
	blueprint.classes["model.Fruit"] =  {
		"__t": "Njk",
		"brand": {
			"flags": [],
			"type": "enum:A, B, C",
			"hash": "SxI"
		}
	};

	... More classes ...

	blueprint.lookup = function( typeId )  {
		var t = typeId.match(/(.{1,3})/g);
		switch( t[0] )  {
			case "Njk":
				switch( t[1] )  {
					case "qpA":
						return "model.Apple";
					case "v5o":
						return "model.Banana";
				}
				return "model.Fruit";
		}
	};

	// Support for requirejs etc.
	if (typeof define === "function" && define.amd) {
		define("blueprint", [], function(){
			return blueprint;
		});
	} else {
		// expose blueprint the old fashioned way.
		window.blueprint = blueprint;
	}
})();

{% endhighlight %}




{% highlight javascript %}

	//Assuming that you have the mGen library and the blueprint in you javascript scope

	//create a registry over the classes.
	var registry = mGen.generate(blueprint);

	//a jsonHandler is used for json mapping
	var jsonHandler = mGen.jsonHandler(registry);

  	// Create some objects
	var apple = new registry.Apple({
		brand: "A",
		radius: 4
	});

	var banana = new registry.Banana({
		length: 5,
		brand: "B"
	});

	// Serialize them to a JSON string and print them
	var appleAsString = jsonHandler.objectToString(apple);
	var bananaAsString = jsonHandler.objectToString(banana);

	// or if you are not using transient fields then you can just
	appleAsString = JSON.stringify(object);



	// Read the objects back from their serialized form
	var appleBack = jsonHandler.stringToObject(appleAsString);
	var bananaBack = jsonHandler.stringToObject(bananaAsString);

	// Or if you know what kind of object you have. You can also create the object directly:
	appleBack = registry.Apple(appleAsString)

	JSON.stringify(def);

{% endhighlight  %}